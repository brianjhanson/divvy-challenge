function redraw(){svg.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}var w=1200,h=1200,barPadding=1,rows,maxCap,minCap,capScale,dataPath="assets/data/trips_med.csv",dataNeighborhoods="assets/data/neighborhoods.json",dataDivvyStations="assets/data/stations.csv",projection=d3.geo.albers().scale(2e5).center([0,41.84562]).rotate([87.65533,0]).translate([h/2,w/2]),path=d3.geo.path().projection(projection),svg=d3.select("#results").append("svg").attr("width",w).attr("height",h).call(d3.behavior.zoom().on("zoom",redraw)).append("g"),setScale=function(t){return maxCap=d3.max(t,function(t){return t.cap}),minCap=d3.min(t,function(t){return t.cap}),capScale=d3.scale.linear().domain([minCap,maxCap]).range([0,10]),console.log(capScale),capScale},parseNeighborhoods=function(){d3.json(dataNeighborhoods,function(t,a){drawNeighborhoods(a),parseStations()})},drawNeighborhoods=function(t){svg.selectAll("path").data(t.features).enter().append("path").attr("d",path).style({fill:"rgba(129, 249, 140, 0.4)",stroke:"white","stroke-width":1})},drawStations=function(t){svg.selectAll("circle").data(t).enter().append("circle").attr("cx",function(t){return projection([t.lon,t.lat])[0]}).attr("cy",function(t){return projection([t.lon,t.lat])[1]}).attr("r",function(t){return capScale(t.cap)}).style("fill","rgba(0,0,0,0.4)").style("opacity",.75)},parseStations=function(){d3.csv(dataDivvyStations,function(t){return{name:t.name,lat:+t.latitude,lon:+t.longitude,cap:+t.dpcapacity}},function(t,a){console.log(a),setScale(a),drawStations(a)})},parseData=function(){d3.csv(dataPath,function(t){return{tripID:+t.trip_id,tripStart:new Date(t.starttime),tripStop:new Date(t.stoptime),tripDuration:+t.tripduration.replace(/[^\d\.\-\ ]/g,""),bikeID:+t.bikeid,stationFromID:+t.from_station_id,stationFromName:t.from_station_name,stationToID:+t.to_station_id,stationToName:t.to_station_name,userType:t.usertype,userGender:t.gender,userBirthYear:new Date(t.birthyear)}},function(t,a){chartBars(a)})},logData=function(t){t.forEach(function(t){console.log(t)})},chartBars=function(t){svg.selectAll("rect").data(t).enter().append("rect").attr("x",function(a,e){return e*(w/t.length)}).attr("y",function(t){return h-t.tripDuration/100}).attr("width",w/t.length-barPadding).attr("height",function(t){return t.tripDuration/100})};parseData(),parseNeighborhoods(),function(){for(var t,a=function(){},e=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=e.length,r=window.console=window.console||{};n--;)t=e[n],r[t]||(r[t]=a)}();